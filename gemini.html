<!DOCTYPE html>
<html lang="en">
<head>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-2262359390313772" crossorigin="anonymous"></script>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JOE HUB - Command Dashboard</title>
  <style>
    :root { --primary: #00ff41; --bg: #0b0e14; --card: #151a25; --text: #e0e6ed; }
    body { font-family: 'Segoe UI', Roboto, sans-serif; background: var(--bg); color: var(--text); margin: 0; min-height: 100vh; overflow-x: hidden; }

    /* DASHBOARD LAYOUT */
    .dashboard-container { max-width: 1400px; margin: 0 auto; padding: 20px; display: flex; flex-direction: column; height: 95vh; }
    
    /* HEADER */
    header { display: flex; justify-content: space-between; align-items: center; padding-bottom: 20px; border-bottom: 1px solid #333; margin-bottom: 20px; }
    .brand { font-size: 1.5rem; font-weight: 900; letter-spacing: 2px; color: var(--primary); display: flex; align-items: center; gap: 10px; }
    .status-badge { font-size: 0.7rem; background: rgba(0, 255, 65, 0.1); border: 1px solid var(--primary); padding: 5px 10px; border-radius: 4px; color: var(--primary); }

    /* SPLIT VIEW LAYOUT */
    .main-interface { display: flex; gap: 20px; flex: 1; height: 100%; overflow: hidden; }
    
    /* SIDEBAR (BUTTONS) */
    .sidebar { width: 300px; overflow-y: auto; padding-right: 10px; display: flex; flex-direction: column; gap: 15px; }
    .sidebar::-webkit-scrollbar { width: 5px; }
    .sidebar::-webkit-scrollbar-thumb { background: #333; border-radius: 5px; }

    /* VIEWPORT (IFRAME) */
    .viewport-container { flex: 1; background: var(--card); border: 1px solid #333; border-radius: 12px; display: flex; flex-direction: column; overflow: hidden; position: relative; }
    .viewport-header { background: #0f121a; padding: 10px 20px; border-bottom: 1px solid #333; display: flex; justify-content: space-between; align-items: center; }
    .url-display { font-family: monospace; color: var(--primary); font-size: 0.9rem; opacity: 0.8; }
    .ext-btn { background: #222; color: white; border: 1px solid #444; padding: 5px 15px; border-radius: 4px; cursor: pointer; font-size: 0.8rem; text-decoration: none; }
    .ext-btn:hover { background: var(--primary); color: black; }

    iframe { width: 100%; height: 100%; border: none; background: white; }
    
    /* BUTTON STYLES */
    .dash-btn { 
        background: var(--card); 
        border: 1px solid rgba(255, 255, 255, 0.05); 
        padding: 15px; 
        border-radius: 8px; 
        cursor: pointer;
        color: white; 
        transition: all 0.2s ease; 
        display: flex;
        align-items: center;
        gap: 15px;
    }
    .dash-btn:hover, .dash-btn.active { border-color: var(--primary); background: rgba(0, 255, 65, 0.05); transform: translateX(5px); }
    .btn-icon { color: var(--primary); font-size: 1.2rem; }
    .btn-name { font-weight: bold; font-size: 0.9rem; }

    /* PLACEHOLDER STATE */
    .empty-state { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; color: #444; }
    .empty-icon { font-size: 4rem; margin-bottom: 20px; opacity: 0.5; }

    /* LOADER */
    #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: var(--bg); z-index: 999; display: flex; align-items: center; justify-content: center; transition: opacity 0.5s; }
    .spinner { width: 40px; height: 40px; border: 3px solid rgba(0,255,65,0.3); border-top-color: var(--primary); border-radius: 50%; animation: spin 1s infinite linear; }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* RESPONSIVE */
    @media (max-width: 768px) {
        .main-interface { flex-direction: column; }
        .sidebar { width: 100%; height: 200px; }
    }
  </style>
</head>
<body>

  <div id="loader"><div class="spinner"></div></div>

  <div class="dashboard-container">
    <header>
      <div class="brand">
        <span>JOE HUB</span>
        <span class="status-badge">COMMAND CENTER</span>
      </div>
      <div id="clock" style="font-family: monospace; opacity: 0.7;">00:00:00</div>
    </header>

    <div class="main-interface">
      <div class="sidebar" id="sidebarList">
        </div>

      <div class="viewport-container">
        <div class="viewport-header">
          <span class="url-display" id="currentUrl">READY TO EXECUTE</span>
          <a href="#" target="_blank" id="extLink" class="ext-btn">OPEN IN NEW TAB ↗</a>
        </div>
        
        <iframe id="mainFrame" name="viewer"></iframe>
        
        <div class="empty-state" id="emptyState">
          <div class="empty-icon">⚡</div>
          <h3>SELECT A MODULE</h3>
          <p>Choose a resource from the sidebar to load it here.</p>
        </div>
      </div>
    </div>
  </div>

  <script>
    const BIN_ID = '6958d60343b1c97be91604b3';
    const MASTER_KEY = '$2a$10$fBoN5/ymnTgk71qgkEb4XOeT4Ge23eShhEZzIbEqqVsZ67KQeev8S';

    const fallbackLinks = [
        { name: "Google Cloud", url: "https://console.cloud.google.com" },
        { name: "Wikipedia (Test)", url: "https://en.wikipedia.org/wiki/Main_Page" }, // Wikipedia usually works in iframes
        { name: "Bing Search", url: "https://www.bing.com" }
    ];

    function updateClock() {
        const now = new Date();
        document.getElementById('clock').textContent = now.toLocaleTimeString();
    }
    setInterval(updateClock, 1000);

    async function loadDashboard() {
        try {
            const res = await fetch(`https://api.jsonbin.io/v3/b/${BIN_ID}/latest`, { 
                headers: { 'X-Master-Key': MASTER_KEY } 
            });
            if (!res.ok) throw new Error("Database fetch failed");
            const data = await res.json();
            const links = data.record.links || fallbackLinks;
            renderSidebar(links);
        } catch(e) { 
            console.log("Loading fallback mode...");
            renderSidebar(fallbackLinks); 
        }

        setTimeout(() => {
            document.getElementById('loader').style.opacity = '0';
            setTimeout(() => { document.getElementById('loader').style.display = 'none'; }, 500);
        }, 800);
    }

    function renderSidebar(links) {
        const sidebar = document.getElementById('sidebarList');
        sidebar.innerHTML = '';
        
        links.forEach(link => {
            const div = document.createElement('div');
            div.className = 'dash-btn';
            
            // Clean URL
            let fullUrl = link.url.includes('http') ? link.url : 'https://' + link.url;
            
            div.onclick = () => loadUrl(fullUrl, link.name, div);
            
            div.innerHTML = `
                <div class="btn-icon">➜</div>
                <div class="btn-name">${link.name}</div>
            `;
            sidebar.appendChild(div);
        });
    }

    function loadUrl(url, name, btnElement) {
        // Highlight active button
        document.querySelectorAll('.dash-btn').forEach(b => b.classList.remove('active'));
        btnElement.classList.add('active');

        // Hide empty state
        document.getElementById('emptyState').style.display = 'none';
        
        // Update Iframe
        document.getElementById('mainFrame').src = url;
        
        // Update Header Info
        document.getElementById('currentUrl').textContent = `RUNNING: ${name.toUpperCase()}`;
        document.getElementById('extLink').href = url;
    }

    window.onload = loadDashboard;
  </script>
</body>
</html>
